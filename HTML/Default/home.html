[% IF page == 'help';
	
	pagetitle = "HELP" | string;
	
	PROCESS helpheader.html;
	
	WRAPPER helpTopicList;
		"<br/><br/>";
		FOREACH link = additionalLinks.help;
			title = link.key | string | html;
			href = link.value;
			PROCESS helpTopic;
		END;
	END;
	
	PROCESS helpfooter.html;

ELSE %]
	[% extJsScripts = BLOCK %]
		<script type="text/javascript" src="[% webroot %]html/home.js?r=[% revision %]"></script>
	
		<script type="text/javascript">
			Ext.EventManager.onDocumentReady(MainMenu.init, MainMenu, true);

			[% IF favorites %]
			// dirty way of initializing the favorites list...
			Ext.EventManager.onDocumentReady(function(){
				Utils.processCommandURL('[% webroot %]plugins/Favorites/index.html?fav');
			});
			[% END %]
		</script>
	[% END %]

	[%
	my_musicItems = BLOCK;
		orderedLinks = ['BROWSE_BY_ARTIST', 'BROWSE_BY_ALBUM', 'BROWSE_BY_GENRE', 'BROWSE_BY_YEAR', 'BROWSE_NEW_MUSIC', 'PLUGIN_RANDOMPLAY'];
		FOREACH item = orderedLinks;
			link = { key=item, value=additionalLinks.browse.$item };
			PROCESS menuItem category='my_music';
		END;
		FOREACH link = additionalLinks.browse;
			IF link.key != 'FAVORITES' && !orderedLinks.grep(link.key).size;
				PROCESS menuItem category='my_music';
			ELSIF link.key == 'FAVORITES';
				useFavorites = 1;
			END;
		END;
		FOREACH link = additionalLinks.search;
			IF link.key == 'SEARCHMUSIC';
				PROCESS menuItem category='my_music' control='<input type="text" id="search" class="x-form-focus" size="30">';
			END;
		END;
	END;
	
	radioItems = BLOCK;
		orderedLinks = ['PLUGIN_LIVE365_MODULE_NAME', 'PLUGIN_PANDORA_MODULE_NAME', 'PLUGIN_PODCAST', 'PLUGIN_RADIOIO_MODULE_NAME', 'PLUGIN_RADIOTIME_MODULE_NAME', 'PLUGIN_SHOUTCASTBROWSER_MODULE_NAME', 'PLUGIN_PICKS_MODULE_NAME'];
		FOREACH item = orderedLinks;
			link.value = additionalLinks.radio.$item;
			link.key = item;
			PROCESS menuItem category='radio';
		END;
		FOREACH link = additionalLinks.radio;
			IF !orderedLinks.grep(link.key).size;
				PROCESS menuItem category='radio';
			END;
		END;
		additionalLinks.icons.RADIO_TUNEIN.url = 'html/images/ServiceProviders/tuneinurl.png';
		control = BLOCK %]
			<input type="text" id="tuneinurl" class="x-form-focus" size="30" value="http://" onfocus="this.select();">
			[% WRAPPER playlink %]onclick="Utils.processPlayerCommand({ params: ['playlist', 'play', Ext.get('tuneinurl').dom.value] });"[% END %]
			[% WRAPPER addlink %]onclick="Utils.processPlayerCommand({ params: ['playlist', 'add', Ext.get('tuneinurl').dom.value] });"[% END %]
		[% END;
		PROCESS menuItem category='radio' link={ key='RADIO_TUNEIN', value='tunein.html?' };
	END;

	music_on_demandItems = BLOCK;
		orderedLinks = ['PLUGIN_LMA_MODULE_NAME', 'PLUGIN_MP3TUNES_MODULE_NAME', 'PLUGIN_RHAPSODY_DIRECT_MODULE_NAME'];
		FOREACH item = orderedLinks;
			link.value = additionalLinks.music_on_demand.$item;
			link.key = item;
			PROCESS menuItem category='music_on_demand';
		END;
		FOREACH link = additionalLinks.music_on_demand;
			IF !orderedLinks.grep(link.key).size;
				PROCESS menuItem category='music_on_demand';
			END;
		END;
		PROCESS menuItem category='radio' link={ key='PLUGIN_PANDORA_MODULE_NAME', value=additionalLinks.radio.PLUGIN_PANDORA_MODULE_NAME };
	END;

	pluginsItems = BLOCK;
		FOREACH link = additionalLinks.plugins;
			PROCESS menuItem category='plugins';
		END;
	END;

	page = page | lower;
	%]

	[% BLOCK menuItem; page = page | lower %]
		<div class="selectorMarker[% IF singleton %] homeMenuSection_singleton[% END %]" onmouseover="Utils.highlight(this [% IF expandable %], MainMenu.onSelectorClicked[% END %]);">
			<div class="selector_topRight"><div class="selector_topLeft"><div class="selector_bottomRight"><div class="selector_bottomLeft">
				<div class="homeMenuItem[% IF (page == 'radio' || page == 'music_on_demand') && additionalLinks.icons.${link.key}.url %] itemWithCover[% END %]" id="[% link.key %]">
					[% IF expandable %]
						<img class="disclosure_home" src="[% webroot %]html/images/spacer.gif"/>
					[% ELSE %]
						<a href="[% link.value %]player=[% player %][% IF category; "&amp;homeCategory=" _ category; END %][% IF expandable; "&amp;page=" _ expandable; END %]" class="browseItemLink">
					[% END %]
						[% IF (page == 'radio' || page == 'music_on_demand') && additionalLinks.icons.${link.key}.url %]
							<span class="browseCover">
								<img src="[% webroot %][% additionalLinks.icons.${link.key}.url.replace('.png', "_50x50_f.png") %]" width="50" border="0" alt="[% link.key | string %]">
							</span>
							<div class="browseItemDetail">[% link.key | string %]</div>
						[% ELSE %]
							[% IF additionalLinks.icons.${link.key}.url %]
								<span class="browseCover">
									<img src="[% webroot %][% additionalLinks.icons.${link.key}.url.replace('.png', "_25x25_f.png") %]" width="25" border="0" alt="[% link.key | string %]">
								</span>
								<div class="smallBrowseItemDetail">
							[% END %]
							[% link.key | getstring %]
							[% IF additionalLinks.icons.${link.key}.url %]
								</div>
							[% END %]
						[% END %]
					[% IF !expandable %]
						</a>
					[% END %]
	
					[% IF control %]
						<span class="browsedbControls">
							[% control %]
						</span>					
					[% END %]
				</div>
			</div>
		</div></div></div></div>
	[% control=''; END %]

	[% IF page == 'my_music' %]
		[% pagetitle = "MY_MUSIC" | string %]

		[% pwd_list = BLOCK %]
			<a href="[% webroot %]home.html?player=[% player %]">[% "HOME" | string %]</a> [% crumbSeparator %] [% "MY_MUSIC" | string %]
		[% END %]

		[% menu = BLOCK %]
		<div class="homeMenuSection" id="my_musicMenu">
			[%- my_musicItems -%]
		</div>

		<div class="homeMenuSection" id="searchMenu">
			<div id="search-results"></div>
		</div>
		[% END %]

	[% ELSIF page == 'radio' %]
		[% pagetitle = "RADIO" | string %]
		[% pwd_list = BLOCK %]
			<a href="[% webroot %]home.html?player=[% player %]">[% "HOME" | string %]</a> [% crumbSeparator %] [% "RADIO" | string %]
		[% END %]

		[% menu = BLOCK %]
		<div class="homeMenuSection" id="radioMenu">
			[%- radioItems -%]
		</div>
		[% END %]

	[% ELSIF page == 'music_on_demand' %]
		[% pagetitle = "MUSIC_ON_DEMAND" | string %]
		[% pwd_list = BLOCK %]
			<a href="[% webroot %]home.html?player=[% player %]">[% "HOME" | string %]</a> [% crumbSeparator %] [% "MUSIC_ON_DEMAND" | string %]
		[% END %]

		[% menu = BLOCK %]
		<div class="homeMenuSection" id="music_on_demandMenu">
			[%- music_on_demandItems -%]
		</div>
		[% END %]

	[% ELSIF page == 'plugins' %]
		[% pagetitle = "PLUGINS" | string %]
		[% pwd_list = BLOCK %]
			<a href="[% webroot %]home.html?player=[% player %]">[% "HOME" | string %]</a> [% crumbSeparator %] [% "PLUGINS" | string %]
		[% END %]

		[% menu = BLOCK %]
		<div class="homeMenuSection" id="pluginsMenu">
			[%- pluginsItems -%]
		</div>
		[% END %]

	[% ELSE %]
		[% pagetitle = "HOME" | string %]
		[% menu = BLOCK %]
		<div class="homeMenuSection" id="homeMenu">
			[% category=''; PROCESS menuItem link.key="MY_MUSIC" link.value="home.html?" expandable="my_music" %]
			<div id="MY_MUSIC_expanded" class="expandableHomeMenuItem">[%- my_musicItems -%]</div>
		
			[% PROCESS menuItem link.key="RADIO" link.value="home.html?" expandable="radio" %]
			<div id="RADIO_expanded" class="expandableHomeMenuItem">[%- radioItems -%]</div>
		
			[% IF additionalLinks.music_on_demand %]
				[% PROCESS menuItem link.key="MUSIC_ON_DEMAND" link.value="home.html?" expandable="music_on_demand" %]
				<div id="MUSIC_ON_DEMAND_expanded" class="expandableHomeMenuItem">[%- music_on_demandItems -%]</div>
			[% END %]

			[% IF favorites;
				control = BLOCK; 
					WRAPPER editlink noTarget=1;
						'href="' _ webroot _ 'plugins/Favorites/index.html?fav"';
					END;
				END;

				PROCESS menuItem category='FAVORITES' expandable=1 
					link = { 
						key = 'FAVORITES',
						value = additionalLinks.browse.FAVORITES
					} 
				%]
				<div id="FAVORITES_expanded" class="expandableHomeMenuItem">
				[% 
					expandable = 0;
					FOREACH entry = favorites;
						control = BLOCK;
							IF entry.type == "audio";
								 WRAPPER playlink noTarget=1 -%]
									href="javascript:void(0);" onClick="Utils.processCommandURL('[% webroot %]plugins/Favorites/index.html?action=play&amp;index=[% loop.index %]&amp;player=[% player | uri %]');"
								[%- END;
								WRAPPER addlink noTarget=1 -%]
									href="javascript:void(0);" onClick="Utils.processCommandURL('[% webroot %]plugins/Favorites/index.html?action=add&amp;index=[% loop.index %]&amp;player=[% player | uri %]');"
								[%- END;
							ELSE;
								PROCESS dummylink;
								PROCESS dummylink;
							END;
						END;
	
						PROCESS menuItem category='' 
							link = {
								key = entry.text,
								value = webroot _ "plugins/Favorites/index.html?&amp;index=" _ loop.index _ "&amp;player=" _ playerURI
							};
					END
				%]
				</div>
			[% END %]

			[% IF additionalLinks.plugins %]
				[% PROCESS menuItem link.key="PLUGINS" link.value="home.html?" expandable="plugins" category=''; expandable = 0 %]
				<div id="PLUGINS_expanded" class="expandableHomeMenuItem">[%- pluginsItems -%]</div>
			[% END %]
		</div>
		[% END %]

	[% END %]

	[% PROCESS pageheader.html noHomeLink=1 %]

	[% menu %]

	[% IF NOT warn AND (album_count OR artistcount OR song_count) %]
		[% infoTab = BLOCK %]
			<span id="albumcount">[% album_count %]</span> [% "WITH" | string -%]
			<span id="songcount">[%- song_count %]</span> [% "BY" | string -%]
			<span id="artistcount">[% artist_count %]</span>.
		[% END %]
	[% END %]

	[% PROCESS pagefooter.html %]
[% END %]
