[% extJsScripts = BLOCK %]
<script type="text/javascript">
	var Plugins = function(){
		return {
			toggle: function(plugin) {
				var enable = plugin.name.match(/\.enable/);
				Ext.get('settingsForm').setStyle({cursor: 'wait'});
				Ext.Ajax.request({
					url: Ext.get('settingsForm').dom.action,
					params: 'useAJAX=1&' + plugin.name + '=1&pageAntiCSRFToken=[% pageAntiCSRFToken %]',
					callback: function() { Ext.get('settingsForm').setStyle({cursor: 'auto'}); },
					success: function(response) {
						plugin.name = enable ? plugin.name.replace(/enable/, 'disable') : plugin.name.replace(/disable/, 'enable'); 
						plugin.value = enable ? '[% "DISABLE" | string %]' : '[% "ENABLE" | string %]';

						if (response.responseText) {
							response = response.responseText.replace(/warning\|/, '');
							Ext.get('statusarea').update(response);
						}
					}
				});
			}
		};
	}();

</script>
[% END %]
[% PROCESS settings/header.html %]

	<div class="prefHead">[% "SETUP_GROUP_PLUGINS" | string %]</div>
	<div class="prefDesc">[% "SETUP_GROUP_PLUGINS_DESC" | string %]</div>

	<p/>

	[% FOREACH plugin = sortedPlugins %]

		[% name     = plugins.$plugin.name %]
		[% desc     = plugins.$plugin.description %]
		[% version  = plugins.$plugin.version %]
		[% settings = plugins.$plugin.optionsURL %]
		[% enabled  = plugins.$plugin.state %]

		[% WRAPPER setting title=name %]
			<!-- XXXX - need to check for pending uninstall / install -->
			[% IF enabled %]

			<input type="button" id="[% name %].toggle" name="[% name %].disable" value="[% 'DISABLE' | string %]" onClick="Plugins.toggle(this)">

				[% IF settings %]

					[% tab = '';
					IF playersetup.$name;
						tab = 'player';
					ELSIF additionalLinks.setup.$name;
						tab = 'advanced';
					END %]

					[% IF tab %]
						<input type="button" value="[% 'SETTINGS' | string %]" onClick="top.Settings.showPlayerSetting('[% tab %]', '[% name %]')">
					[% END %]

				[% END %]

			[% ELSE %]

			<input type="button" id="[% name %].toggle" name="[% name %].enable" value="[% 'ENABLE' | string %]" onClick="Plugins.toggle(this)">

			[% END %]

<!-- uninstall isn't implemented in the page handler? -->
<!-- 		<input type="submit" id="[% name %].uninstall" name="[% name %].uninstall" value="[% 'UNINSTALL' | string %]" onClick="Plugins.uninstall(this)">
 -->
		[% END %]

	[%- END -%]

[% PROCESS settings/footer.html %]
	