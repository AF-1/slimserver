[%- BLOCK pluginLink -%]
	[% IF enabled && settings %]
		<a href="[% webroot %]settings/[% settings %]?player=[% playerURI %]&amp;playerid=[% playerURI %]&amp;noSettingsList">[% 'SETTINGS' | string %]</a>
	[% END %]
[%- END -%]
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
	<head>
		<title>[% "SQUEEZECENTER" | string %]</title>

		<link rel="stylesheet" type="text/css" href="/html/ext/resources/css/ext-all.css" />
		<link rel="stylesheet" type="text/css" href="[% webroot %]slim-ext.css?r=[% revision %]" />
		<link rel="stylesheet" type="text/css" href="[% webroot %]slimserver.css?r=[% revision %]" />

		<script type="text/javascript" src="/html/ext/adapter/ext/ext-base.js?r=[% revision %]"></script>
		<script type="text/javascript" src="/html/ext/ext-all[% IF debug %]-debug[% END %].js?r=[% revision %]"></script>
		<script type="text/javascript">[% PROCESS html/vars.js %]</script>
		<script type="text/javascript" src="[% webroot %]html/utils.js?r=[% revision %]"></script>
		<script type="text/javascript" src="[% webroot %]html/settings.js?r=[% revision %]"></script>
		<script type="text/javascript" src="[% webroot %]html/fileselector.js?r=[% revision %]"></script>

		<script type="text/javascript">
			var strings = new Array();
			[% PROCESS jsString id='CLOSE' jsId='' %]
			[% PROCESS jsString id='BROWSE' jsId='' %]
			[% PROCESS jsString id='SETTINGS' jsId='' %]
			[% PROCESS jsString id='SETUP_SELECT_FOLDER' jsId='choose_folder' %]
			[% PROCESS jsString id='SETUP_SELECT_FILE' jsId='choose_file' %]
			[% PROCESS jsString id='CHOOSE_PLAYER' jsId='' %]

			// display player list if we're in the player settings
			[%-
			pageId = '^' _ page _ '$';
			pageLink = orderedLinks.grep(pageId);

			IF needsClient;
				USE Clients;
				players = Clients.get("id") %]
	
				var page = '[% page %]';
				var playerList = new Array(
					[% FOREACH playerobj IN players -%]
						{
							id: "[% playerobj.id %]",
							name: "[% playerobj.name %]"
						}[% IF !loop.last; ','; END %]
					[% END %]
				);

				// remember the last loaded page - to be used when the player tab is selected next time
				try { parent.Utils.setCookie('SqueezeCenter-playersettings', '[% playersetup.$page %]'); }
				catch(e) {}

			[%- END;

			IF pageLink.size > 0 %]

				var page = '[% page %]';
				var settingsList = new Array(
					[% FOREACH link IN orderedLinks -%]
						{ 
							id: "[% link %]",
							url: "[% needsClient ? playersetup.$link : additionalLinks.setup.$link %]",
							name: "[% link | string %]"
						}[% IF !loop.last; ','; END %]
					[% END %]
				);

				try { parent.Utils.setCookie('SqueezeCenter-advancedsettings', '[% additionalLinks.setup.$page %]'); }
				catch(e) {}

			[% END %]

			// pages using the fileselector may set a filter (see iTunes)
			var fsFilter = new Array();

			Ext.EventManager.onDocumentReady(SettingsPage.init, SettingsPage, true);

			Ext.EventManager.onDocumentReady(function(){
				var el;
				[%- FOREACH pref = validate; IF pref.value %]
					if (el = Ext.get('[% pref.key %]')) {
						el.on('blur', function(){ SettingsPage.validatePref('[% pref.key %]', '[% namespace %]'); } );
						el.addClass('canValidate');
					}
				[%- END; END %]
			});
		</script>

		[% IF pageHeaderScripts && NOT extJsScripts %]
			[% pageHeaderScripts %]
		[% ELSE %]
			[% extJsScripts %]
		[% END %]

		<style>
			html {
				overflow: auto;
				background-color: white;
			}

		[%- IF debug %]
			.x-layout-panel-body { background: white; }
			.x-btn-text, .x-btn button { color: black; }
			.x-dlg .x-tabs-bottom .x-tabs-body {
				background: white;
				color: black;
			}
		[%- END %]
		</style>

		<!--[if lte IE 6]>
		<link href="[% webroot %]ie.css?r=[% revision %]" type="text/css" rel="stylesheet">
		<![endif]-->
		<!--[if IE 7]>
		<link href="[% webroot %]ie7.css?r=[% revision %]" type="text/css" rel="stylesheet">
		<![endif]-->
	</head>

	<body class="[% bodyClass || "settings" %]">

		[% IF needsClient || (pageLink.size > 0 && !noSettingsList) %]
		<div class="buttonbar">
			<table>
				<tr>
					[%- IF needsClient %]
						<td><span id="playerSelector"></span></td>
					[% END %]
					[%- IF !noSettingsList %]
						<td><span id="settingsSelector"></span></td>
					[% END %]
				<tr>
			</table>
		</div>
		<div class="buttonbarSpacer">&nbsp;</div>
		[% END -%]

		[% IF !noForm %]
		[% IF warning %]
			<div id="statusarea" class="statusarea">
				[% warning %]
				&nbsp;
			</div>
		[% END %]

		<form name="settingsForm" id="settingsForm" method="post" action="[% webroot %][% path %][% IF playerid %]?playerid=[% playerid | uri %][% END %]">

		<div id="settingsRegion">

			<input type=hidden value="1" name="saveSettings">
			<input type=hidden value="0" name="useAJAX">
			<input type=hidden value="[% page %]" name="page">
			[% IF playerid %]<input type=hidden value="[% playerid %]" name="playerid">[% END %]
			[% IF player %]<input type=hidden value="[% player %]" name="player">[% END %]

		[% END %]
