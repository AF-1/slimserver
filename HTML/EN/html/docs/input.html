[SET pageicon help]
[SET title Using Input Modes]
[SET techinfo 1]
[INCLUDE helpheader.html]

  <h4>Overview</h4>
  <p>
    The Slim Server software comes equipped with a number (currently one) of
    generic input modes which can be used by other modes to handle interaction
    with the user via the remote. This allows module writers to concentrate on
    what to do with the input rather than the gathering of that input.
  </p>
  <p>
    The general method of using these input modes is to push into them from
    your module, setting certain parameters as desired. The most important
    parameter will be <em>callback</em> which is a reference to a function
    that will be called when the input session is complete, and which will
    then handle that input. Other parameters will vary depending on the input
    mode being used.
  </p>
  <p>
    When circumstances indicate the possibility that input is complete, an
    exit event is generated. The <em>callback</em> function will be invoked
    to determine the action to be taken. It will be called with parameters
    indicating the client and the type of exit event. The input modes do not
    exit themselves, it is left to the <em>callback</em> function to decide
    when to leave the input mode.
  </p>
  <p>
    It should be noted that the parameters supplied to the input modes are
    stored in the stack of mode parameter hashes contained in the client struct.
    As such, all parameters will be accessible to the callback function until
    the input mode is left. If the mode is popped off the mode stack all
    parameters will be lost. Any maintenance of the parameters between entries
    into the input mode are the responsibility of the calling mode.
  </p>
  <p>
    The input mode names are INPUT.<em>modulename</em>, where <em>modulename</em>
    is the name of the .pm file. A typical entry into the INPUT.Text mode follows:
<pre>
Slim::Buttons::Common::pushMode($client,'INPUT.Text',
					&#123;'callback' =&gt; \&amp;myCallback
					,'valueRef' =&gt; 'Some Initial String'
					,'charsRef' =&gt; 'Upper'
					,'header' =&gt; string('SOME_STRING_FOR_THE_TOP')
					&#125;);
</pre>
  </p>
  <h4>The Input Modes</h4>
  <p>
    <dl>
      <dt><a href="#Text">Text</a></dt>
      <dd>Handles input of arbitrary strings.</dd>
      <dt><a href="#List">ListSelect</a></dt>
      <dd>Handles selection of an item from a list of options.</dd>
      <dt><a href="#Tree">TreeSelect</a></dt>
      <dd>Handles navigation of and selection from a tree of options.</dd>
      <dt><a href="#Bar">Bar</a></dt>
      <dd>
        Handles selection of a number from a range, using the amount a bar
        is filled to indicate position of the number in the range.
      </dd>
    </dl>
  </p>
  <h4><a id="Text"></a>Text</h4>
  <h5>Description</h5>
  <p>
    The <strong>Text</strong> input mode is used to enter arbitrary strings.
    It restricts characters in the string to a list of allowable characters
    which can be provided when entering the mode. The rightarrow symbol is
    used to indicate when advancing past the end of the string will generate
    an exit event. It is never allowed anywhere in the string other than the
    end. Calling modes should strip off this symbol from the end of the string
    prior to using the input value.
  </p>
  <p>
    The string is scrolled to keep the cursor within the viewable area, except
    when the viewable area is scrolled manually. Any change in either the cursor
    position or the character at the cursor results in the viewable area being
    snapped back such that the cursor is again visable.
  </p>
  <p>
    On entry into the mode, any characters in the initial string not within the
    list of allowable characters are replaced by spaces (if the space character
    is allowable) or are removed.
  </p>
  <h5>Parameters</h5>
  <p>
    The following parameters are used by the INPUT.Text mode. They are listed
    in the order of likelyhood to be supplied. Other parameters can be supplied
    for use by the callback function, but will not otherwise have any effect
    on the INPUT.Text behavior.
  </p>
  <p>
    <dl>
      <dt>callback</dt>
      <dd>Default: none</dd>
      <dd>
        A code reference which is called whenever an exit event occurs. This
        parameter should always be supplied by the calling mode, otherwise
        INPUT.Text will simply perform a pop mode on an exit event, potentially
        losing any input. The procedure referenced should take the client struct
        as the first parameter and the exit event type as the second.
      </dd>
      <dt>header</dt>
      <dd>Default: &quot;Enter Text:&quot; (not localized)</dd>
      <dd>
        String to display on the top line of the display. This string is displayed
        as supplied, so be sure to localize any strings used.
      </dd>
      <dt>valueRef</dt>
      <dd>Default: &quot;&quot;</dd>
      <dd>
        <em>valueRef</em> contains a reference to the string being edited. It
        can initially be set to a plain string scalar, in which case it will
        be converted into a reference to that scalar.
      </dd>
      <dt>charsRef</dt>
      <dd>Default: reference to internal @UpperChars array</dd>
      <dd>
        <em>charsRef</em> contains a reference to the list of allowable characters.
        It can be supplied as an array reference, or as the strings &quot;upper&quot;
        or &quot;both&quot;, which are converted to references to the internal
        @UpperChars and @BothChars arrays, respectively.
      </dd>
      <dt>doublesizeReplace</dt>
      <dd>Default: none</dd>
      <dd>
        A reference to a hash of characters to replace in doublesize mode for
        display. This would most likely be done for custom characters which
        have no doublesize equivalents. The referenced hash has keys equal
        to the character to replace, and values equal to the character to use
        in doublesize mode. For example, to replace the custom character myCustom
        with &quot;M&quot; when doublesized would be 
        <code>&#123;Slim::Hardware::VFD::symbol(&quot;myCustom&quot;) =&gt; &quot;M&quot;&#125;</code>
      </dd>
      <dt>charIndex</dt>
      <dd>Default: index of the current character within the charsRef array</dd>
      <dd>
        The index of the current character within the charsRef array. If
        supplied, and if cursorPos ends up at the end of the valueRef string,
        the character at this index will be appended to the end of valueRef,
        otherwise, the rightarrow will be used. This parameter will not usually
        need to be set on entry, but is used within the INPUT.Text mode.
      </dd>
      <dt>cursorPos</dt>
      <dd>Default: end of initial string</dd>
      <dd>
        The current position of the cursor, which determines which character will
        be modified. This parameter will not usually need to be set on entry, but
        is used within the INPUT.Text mode.
      </dd>
      <dt>displayPos</dt>
      <dd>
        Default: either the beginning of the string, or such that the cursor
        is at the rightmost position on the display.
      </dd>
      <dd>
        The position within the string at which to begin the display in
        single-height mode. If supplied when entering the mode it will be
        ignored. This parameter will not usually need to be set on entry, but
        is used within the INPUT.Text mode.
      </dd>
      <dt>displayPos2X</dt>
      <dd>
        Default: either the beginning of the string, or such that the cursor
        is at the rightmost position on the display.
      </dd>
      <dd>
        The position within the string at which to begin the display in
        double-size mode. If supplied when entering the mode it will be ignored.
        This parameter will not usually need to be set on entry, but
        is used within the INPUT.Text mode.
      </dd>
      <dt>rightIndex</dt>
      <dd>Default: index of rightarrow within the charsRef array</dd>
      <dd>
        If rightarrow is within the list of allowable characters, its index is
        stored in the <em>rightIndex</em> parameter. Otherwise, the value of
        <em>rightIndex</em> is set to -1. If supplied when entering the mode it
        will be ignored. This parameter will not usually need to be set on entry,
        but is used within the INPUT.Text mode.
      </dd>
    </dl>
  </p>
  <h5>Exit Event Types</h5>
  <p>
    The callback function should handle the following event types in some way.
    Ignoring them is acceptable, crashing the server is not.
  </p>
  <p>
    <dl>
      <dt>backspace</dt>
      <dd>
        Generated when the backspace function is called when the cursor is at the
        beginning of the string.
      </dd>
      <dt>cursor_left</dt>
      <dd>
        Generated when the cursor is requested to move left, and is already at the
        beginning of the string.
      </dd>
      <dt>cursor_right</dt>
      <dd>
        Generated when the cursor is requested to move left, and is already at the
        beginning of the string.
      </dd>
      <dt>delete</dt>
      <dd>
        Generated when the delete function is called on the last character in the
        string.
      <dd>
      <dt>nextChar</dt>
      <dd>
        Generated when the nextChar function is called and the current character
        is the right arrow.
      </dd>
      <dt>scroll_left</dt>
      <dd>
        Generated when a scroll to the left is requested, but the beginning of the
        string is already being displayed.
      </dd>
      <dt>scroll_right</dt>
      <dd>
        Generated when a scroll to the right is requested, but the last character
        of the string is already being displayed in the leftmost column of the
        display.
      </dd>
      <dt><em>Other</em></dt>
      <dd>
        Generated by the exit function where the type is determined by the
        argument supplied. Usually will be a button name like play or add, but
        be prepared for anything.
      </dd>
    </dl>
  </p>
  <h5>Functions</h5>
  <p>
    <dl>
      <dt>up</dt>
      <dd>
        Changes the current character to the one preceding it in the character
        list. Repeat is allowed and accelerates.
      </dd>
      <dt>down</dt>
      <dd>
        Changes the current character to the one following it in the character
        list. Repeat is allowed and accelerates.
      </dd>
      <dt>backspace</dt>
      <dd>
        The current character is deleted and the cursor moved one place to the
        left. If that movement would place the cursor before the first position
        in the string, an exit event is generated with a type of <em>backspace</em>.
        This function is not designed to be used with repeat.
      </dd>
      <dt>delete</dt>
      <dd>
        Similar to backspace, except the cursor is not moved. If the last character
        in the string is deleted, an exit event of type <em>delete</em> is generated.
        This function is not designed to be used with repeat.
      </dd>
      <dt>nextchar</dt>
      <dd>
        The cursor is advanced to the next position. If the cursor was at the end
        of the string and the rightarrow was not the current character, then an
        additional character is added to the end of the string prior to moving
        the cursor there. The added character will be the rightarrow character if
        that character is in the list of allowable characters, otherwise the first
        character in the list is used. If the cursor was at the end and the current
        character was the rightarrow, then an exit event of type <em>nextchar</em>
        is generated. This function is not designed to be used with repeat.
      </dd>
      <dt>cursor</dt>
      <dd>
        This function takes an argument to indicate the direction and distance
        to move the cursor. Use <em>left</em> to move the cursor left and <em>right</em>
        to move it right. The left or right may be followed by an underscore
        and a number indicating the distance to move in that direction. If no
        distance is specified, it defaults to a value of one. If the cursor was
        originally at either end of the string and is requested to move off the
        end, an exit event is generated with a type of either <em>cursor_left</em>
        or <em>cursor_right</em>, depending on the requested direction. Repeat
        is allowed, and takes place at a constant rate. The cursor stops when
        it hits the end under repeat, but an exit event is not generated until
        the button is released and pressed again.
      </dd>
      <dt>scroll</dt>
      <dd>
        This function takes an argument to indicate the direction and distance
        to move the viewable area. Use <em>left</em> to move the viewable area
        left and <em>right</em> to move it right. The left or right may be
        followed by an underscore and a number indicating the distance to move
        in that direction. If no distance is specified, it defaults to a value
        of one. If the beginning of the viewable area was originally at either
        end of the string and is requested to move off the end, an exit event
        is generated with a type of either <em>scroll_left</em> or
        <em>scroll_right</em>, depending on the requested direction. Repeat is
        allowed, and takes place at a constant rate. The movement stops when it
        hits the end under repeat, but an exit event is not generated until the
        button is released and pressed again.
      </dd>
      <dt>insert</dt>
      <dd>
        Inserts a character at the current cursor location. The character to be
        inserted can be supplied as an argument to the function, otherwise the
        first non-rightarrow character in the character list is used. Any
        supplied character must be in the allowed list of characters, otherwise
        a space character is substituted. Since the design of the button mapping
        mechanism does not allow for the use of the space character, the =
        character, or the # character within arguments, alternate representations
        are required. These can be specified as follows:
        <ul>
          <li>anything beginning with &quot;sp&quot; for the space character</li>
          <li>anything beginning with &quot;eq&quot; for the = character</li>
          <li>
            any of &quot;hash&quot;, &quot;sharp&quot;, &quot;pound&quot;, or 
            a string beginning with &quot;num&quot for the # character
          </li>
        </ul>
        This function is not designed to be used with repeat.
      </dd>
      <dt>clear</dt>
      <dd>
        Truncates the string and adds either the rightarrow or, if the rightarrow
        is not in the list of characters, the first character in the list.
        This function is not designed to be used with repeat.
      </dd>
      <dt>numberLetter</dt>
      <dd>
        This function takes an argument, which it then passes to
        Slim::Buttons::Common::numberLetter.  The returned character is then
        checked against the list of allowable characters, and replaced by a
        space if not present. The cursor is advanced to the next character if
        a different button is pressed than the previous, or after an amount of
        time equal to the <em>displayTextTimeout</em> setting passes.
        This function is not designed to be used with repeat.
      </dd>
      <dt>letter</dt>
      <dd>
        Takes an argument, which is then validated (checked against the list of
        characters, with similar replacements as the <em>insert</em> function).
        The current character is changed to the validated character, and the
        cursor advanced. This function is not designed to be used with repeat.
      </dd>
      <dt>exit</dt>
      <dd>
        Takes an argument. An exit event is generated with the type being the
        supplied argument. If no argument is supplied, the exit event type is
        <em>exit</em>.
      </dd>
    </dl>
  </p>
  <h4><a id="List"></a>ListSelect</h4>
  <h5>Description</h5>
  <p>
    Not currently implemented.  The following information is only preliminary.
  </p>
  <p>
    The <strong>ListSelect</strong> input mode is used to select one item from
    a list of items.  The items in the list can have different representations
    internally and externally.  An onChange handler can be provided for immediate
    effects of changing position in the list.
  </p>
  <p>
    On entry into the mode, the initial selection will depend on the supplied
    parameters.  If <em>valueRef</em> is supplied, and the value it references
    is contained in the list referenced by the supplied <em>listRef</em>, then
    <em>listIndex</em> is updated to reflect the position of the supplied value.
    If <em>valueRef</em> is not supplied, or if its value does not appear in
    the list, it will be updated to be the value at position <em>listIndex</em>
    (if supplied and in bounds, 0 if not supplied or out of bounds).
  <p>
    This mode will not maintain state between invocations, so if such state
    information needs to be kept, it is the responsibility of the calling
    mode to do so.
  </p>
  <h5>Parameters</h5>
  <p>
    The following parameters are used by the INPUT.ListSelect mode. They are
    listed in the order of likelyhood to be supplied. Other parameters can be
    supplied for use by the callback, external display, or change handler
    functions, but will not otherwise have any effect on the INPUT.ListSelect
    behavior.
  </p>
  <p>
    <dl>
      <dt>listRef</dt>
      <dd>Default: none</dd>
      <dd>
        An array reference to the list of items.  This parameter must be supplied
        or the INPUT.ListSelect mode will not be entered.  This list should be
        the internal representations of the item values.
      </dd>
      <dt>callback</dt>
      <dd>Default: none</dd>
      <dd>
        A code reference which is called whenever an exit event occurs. This
        parameter should always be supplied by the calling mode, otherwise
        INPUT.ListSelect will simply perform a pop mode on an exit event,
        potentially losing any input. The procedure referenced should take
        the client struct as the first parameter and the exit event type
        as the second.
      </dd>
      <dt>header</dt>
      <dd>Default: &quot;Select item:&quot; (not localized)</dd>
      <dd>
        String to display on the top line of the display. This string is displayed
        as supplied, so be sure to localize any strings used.
      </dd>
      <dt>valueRef</dt>
      <dd>
        Default: reference to copy of item in <em>listIndex</em> position in list
      </dd>
      <dd>
        <em>valueRef</em> contains a reference to the currently selected item.
        Typically this will be a reference to a variable local to the calling
        mode, so that the final value will not need to be explicitly assigned
        to some local variable.
      </dd>
      <dt>listIndex</dt>
      <dd>Default: 0</dd>
      <dd>
        The (zero based) index of the currently selected item.
      </dd>
      <dt>listWrap</dt>
      <dd>Default: 1</dd>
      <dd>
        Determines whether or not to wrap around the ends of the list. If set
        to 0, attempts to scroll past either end of the list will result in a
        bump up or down animation, depending on the requested direction. When
        set to 1 (the default), moving up past the beginning of the list will
        take you to the end of the list, and moving down beyond the end of the
        list will take you back to the beginning. The ends are sticky, so the
        wraparound will not take place while repeating.
      </dd>
      <dt>externRef</dt>
      <dd>Default: none</dd>
      <dd>
        This can be either an array ref or a code ref. If an array ref, then
        the external value is the value at the same index as the internal value.
        If a code ref, then the client, or internal value, or both are passed
        as arguments to the supplied function, and the return value is used as
        the external value.  The arguments are passed according to the value
        of <em>externRefArgs</em>. If this parameter is not supplied, the
        internal value will be used as the external value.
      </dd>
      <dt>externRefArgs</dt>
      <dd>Default: &quot;CV&quot;</dd>
      <dd>
        One of &quot;CV&quot;, &quot;C&quot;, or &quot;V&quot;.  The C indicates
        that the client struct should be passed to the function to determine
        the external value, the V indicates that the internal value should be
        passed.
      </dd>
      <dt>onChange</dt>
      <dd>Default: none</dd>
      <dd>
        A code reference which is executed each time the currently selected
        item changes. It is passed arguments according to the value of
        <em>onChangeArgs</em>. Any return value will be ignored.
      </dd>
      <dt>onChangeArgs</dt>
      <dd>Default: &quot;CV&quot;</dd>
      <dd>
        One of &quot;CV&quot;, &quot;C&quot;, or &quot;V&quot;.  The C indicates
        that the client struct should be passed to the function, the V indicates
        that the internal value should be passed.
      </dd>
  <h4><a id="Tree"></a>TreeSelect</h4>
  <h5>Description</h5>
  <p>Not currently implemented.</p>
  <h4><a id="Bar"></a>Bar</h4>
  <h5>Description</h5>
  <p>Not currently implemented.</p>
[INCLUDE helpfooter.html]
