[% IF useExtJS; extJsScripts = BLOCK %]   
	<script TYPE="text/javascript">
		Ext.onReady(function() {
			// I'm sorry IE6 laggers
			if (!Ext.isIE6) {
				Alarm.initSliders();
				Alarm.initDefaultVolumeBtns();
			}

			var el;
			if (el = Ext.get('alarm_remove_[% newAlarmID %]')) {
				el.on({
					click: {
						fn: function() {
							Ext.get('alarmtime[% newAlarmID %]').dom.value = '';
							Ext.get('alarm[% newAlarmID %]').setDisplayed('none');
							Ext.get('button[% newAlarmID %]').show();
						}
					}
				});
			}

			[% IF prefs.alarms.size %]   
			if (el = Ext.get('alarm[% newAlarmID %]'))
				el.setDisplayed('none');
			[% END %]
		});

		var Alarm = {
			sliders: new Array(),

			tip: {
				init : function(slider){
					slider.on('dragstart', this.onSlide, this);
					slider.on('drag', this.onSlide, this);
					slider.on('change', this.onSlide, this);
				},
			
				onSlide : function(slider){
					slider.input.dom.value = slider.getValue();
				}
			},

			initSliders: function() {
				var tpl = new Ext.Template('<span class="settingsSlider" id="alarmvolume_slider_{id}"></span>');
				var items = Ext.DomQuery.select('input.volumeSlider');
				
				for (var i = 0; i < items.length; i++) {
					var el;
	
					if (el = Ext.get(items[i].id)) {
	
						var sliderEl = tpl.insertBefore(el, {id:el.id}, true);	
						
						this.sliders[el.id] = new Ext.Slider({
							renderTo: sliderEl,
							width: 200,
							minValue: 0,
							maxValue: 100,
							plugins: this.tip,
							value: isNaN(parseInt(el.dom.value)) ? 0 : parseInt(el.dom.value),
					 		input: el,
					 		setVolume: function(v){
								v = parseInt(v);
								if (isNaN(v))
									v = 0;
									
								this.setValue(v);
							}
						});

						el.on({
							change: {
								fn: function(ev, i){
									this.setVolume(i.value);
								},
								scope: this.sliders[el.id]
							},
							keyup: {
								fn: function(ev, i){
									this.setVolume(i.value);
								},
								scope: this.sliders[el.id]
							}
						});
					}
				}
			},

			useDefaultVolume: function(id, enabled){

				if ( id.match(/usesDefaultVolume(.*)/) )
					id = RegExp.$1;

				var el;
				if (el = Ext.get('alarmvolume' + id))
					el.dom.disabled = enabled;

				if (this.sliders['alarmvolume' + id])
					this.sliders['alarmvolume' + id].setDisabled(enabled);
			},
			
			initDefaultVolumeBtns: function(){
				var items = Ext.DomQuery.select('input.usesDefaultVolume');
				
				for (var i = 0; i < items.length; i++) {
	
					this.useDefaultVolume(items[i].id, items[i].checked);
		
					var el;
					if (el = Ext.get(items[i].id)) {
						el.on({
							change: {
								fn: function(ev, i){
									this.useDefaultVolume(i.id, i.checked);
								},
								scope: this
							}
						});
					}
				}
			}
		};
	</script>   
[% END; END %]
[% BLOCK alarmSetting %]
	<table cellspacing="0">
		<tr>
			<td><label for="alarmtime[% alarm.id %]" class="stdlabel">[% "ALARM_SET" | string %][% "COLON" | string %]</label>&nbsp;</td>
			<td>
				<input type="text" class="stdedit" name="alarmtime[% alarm.id %]" id="alarmtime[% alarm.id %]" value="[% alarm.timeStr %]" size="15">
				<input type="hidden" name="alarm_id_[% alarm.id %]" value="1">
			</td>
		</tr>

		<tr>
			<td><label for="alarmdays[% alarm.id %]" class="stdlabel">[% "ALARM_SET_DAYS" | string %][% "COLON" | string %]</label>&nbsp;</td>
			<td><table><tr>
				[% FOREACH day = [1 .. 7] %]
					[% day = day % 7 %]
					<td>
						<input type="checkbox" name="alarmday[% alarm.id %][% day %]" id="alarmday[% alarm.id %][% day %]" value="1" [% alarm.day(day) ? "checked" : "" %]>
						<label for="alarmday[% alarm.id %][% day %]">[% "ALARM_DAY$day" | string %]</label>
					</td>
				[% END %]
			</tr></table>
			</td>
		</tr>

		<tr>
			<td><label for="alarmplaylist[% alarm.id %]" class="stdlabel">[% "ALARM_SELECT_PLAYLIST" | string %][% "COLON" | string %]</label>&nbsp;</td>

			<td><select class="stdedit" name="alarmplaylist[% alarm.id %]" id="alarmplaylist[% alarm.id %]">
	
				[% FOREACH type IN playlistOptions  %]
					<optgroup label="[% type.key %]">
						[% FOREACH option IN type.value %]
							<option [% IF alarm.playlist == option.value %]selected [% END %]value="[% option.value %]">[% option.key %]</option>
						[%- END -%]
					</optgroup>
				[%- END -%]
			
			</select></td>
		</tr>

		<tr>
			<td><label for="alarmvolume[% alarm.id %]" class="stdlabel">[% "SETUP_ALARMVOLUME" | string %][% "COLON" | string %]</label>&nbsp;</td>
			<td>
				<input type="checkbox" name="usesDefaultVolume[% alarm.id %]" class="usesDefaultVolume" id="usesDefaultVolume[% alarm.id %]" value="1"  [% alarm.usesDefaultVolume() ? "checked" : "" %]>
				<label for="usesDefaultVolume[% alarm.id %]" class="stdlabel">[% "ALARM_USE_DEFAULT_VOLUME" | string %]</label><br/>
				<input type="text" class="stdedit volumeSlider" name="alarmvolume[% alarm.id %]" id="alarmvolume[% alarm.id %]" value="[% alarm.volume || prefs.pref_alarmDefaultVolume %]" size="3">
			</td>
		</tr>

		<tr>
			<td><label for="alarm[% alarm.id %]" class="stdlabel">[% "ALARM_ALARM_ENABLED" | string %][% "COLON" | string %]</label>&nbsp;</td>
			<td><select class="stdedit" name="alarm_enable[% alarm.id %]" id="alarm_enable[% alarm.id %]">
	
				[% FOREACH option = {
					'1' => 'YES',
					'0' => 'NO',
				} %]
					<option [% IF alarm.enabled == option.key %]selected='selected' [% END %]value="[% option.key %]">[% option.value | string %]</option>
				[%- END -%]
			
			</select></td>
		</tr>

		<tr>
			<td><label for="alarm[% alarm.id %]" class="stdlabel">[% "ALARM_ALARM_REPEAT" | string %][% "COLON" | string %]</label>&nbsp;</td>
			<td><select class="stdedit" name="alarm_repeat[% alarm.id %]" id="alarm_repeat[% alarm.id %]">
	
				[% FOREACH option = {
					'1' => 'YES',
					'0' => 'NO',
				} %]
					<option [% IF alarm.repeat == option.key %]selected='selected' [% END %]value="[% option.key %]">[% option.value | string %]</option>
				[%- END -%]
			
			</select></td>
		</tr>

		[% IF alarm.id != newAlarmID || useExtJS %]
		<tr><td>
			<input name="alarm_remove_[% alarm.id %]" type="[% useExtJS && alarm.id == newAlarmID ? 'button' : 'submit' %]" class="stdclick" value="[% "ALARM_DELETE" | string %]" id="alarm_remove_[% alarm.id %]">
		</td></tr>
		[% END %]
	</table>
[% END %]

[% PROCESS settings/header.html %]

	[% WRAPPER setting title="ALARM_ALARMS_ENABLED" desc="ALARM_ALARMS_ENABLED_DESC" %]
		<select class="stdedit" name="pref_alarmsEnabled" id="pref_alarmsEnabled">
	
			[% FOREACH option = {
				'1' => 'YES',
				'0' => 'NO',
			} %]
				<option [% IF prefs.pref_alarmsEnabled %]selected='selected' [% END %]value="[% option.key %]">[% option.value | string %]</option>
			[%- END -%]
			
		</select>
	[% END %]

	[% IF useExtJS && prefs.alarms.size %]
		[% WRAPPER setting title="ALARM" desc="ALARM_ADD_DESC" sectionID="button" _ newAlarmID %]
			<input name="AddAlarm" type="button" class="stdclick" value="[% "ALARM_ADD" | string %]" onclick="Ext.get('alarm[% newAlarmID %]').show();Ext.get('button[% newAlarmID %]').setDisplayed('none');">
		[% END %]
	[% END %]

	[% WRAPPER setting title="ALARM_NEW" desc="" sectionID="alarm" _ newAlarmID %]
		[% PROCESS alarmSetting alarm = { 
			id      => newAlarmID
			day     => 1
			enabled => 1
			repeat  => 1
		} %]
	[% END %]

	[% FOREACH alarm = prefs.alarms %]
		
		[% WRAPPER setting title="$alarm.displayStr" desc="" %]
			[% PROCESS alarmSetting %]
		[% END %]
		
	[% END %]

	[% WRAPPER setting title="ALARM_DEFAULT_VOLUME" desc="" %]
		<input type="text" class="stdedit volumeSlider" name="pref_alarmDefaultVolume" id="alarmDefaultVolume" value="[% prefs.pref_alarmDefaultVolume %]" size="3">
	[% END %]

	[% WRAPPER setting title="SETUP_SNOOZE_SECONDS" desc="SETUP_SNOOZE_SECONDS_DESC" %]
		<input type="text" class="stdedit" name="pref_alarmSnoozeSeconds" id="alarmSnoozeSeconds" value="[% prefs.pref_alarmSnoozeSeconds %]" size="20">
	[% END %]

	[% WRAPPER setting title="ALARM_FADE" desc="" %]
		<select class="stdedit" name="pref_alarmfadeseconds" id="pref_alarmfadeseconds">
	
			[% FOREACH option = {
				'1' => 'YES',
				'0' => 'NO',
			} %]
				<option [% IF prefs.pref_alarmfadeseconds %]selected='selected' [% END %]value="[% option.key %]">[% option.value | string %]</option>
			[%- END -%]
			
		</select>
	[% END %]

[% PROCESS settings/footer.html %]
