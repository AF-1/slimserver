[% IF query %]
	[%# Add the search query to each link if available %]
	[% searchquery = 'query=' _ query _ '&amp;' %]
[% END %]

[% FILTER null %]
[% pageicon = 'RADIO'; noSpacer = NOT streaminfo; %]
[% pwd_list = [];
	FOREACH crumb IN crumb;
		crumbItem = BLOCK %]
			<a href="index.html?[% searchquery %]player=[% playerURI %]&amp;index=[% crumb.index %]">[% crumb.name %]</a>
		[% END %]
		[% pwd_list.push(crumbItem) %]
	[% END %]
[% END # filter -%]

[% IF useAJAX %][% pageHeaderScripts = BLOCK %]
	<script TYPE="text/javascript">[% PROCESS html/vars.js %]</script>
	<script type="text/javascript" src="[% webroot %]html/prototype.js?r=[% revision %]" ></script>
	<script type="text/javascript" src="[% webroot %]html/scriptaculous/scriptaculous.js?load=effects,dragdrop&amp;r=[% revision %]"></script>
	<script TYPE="text/javascript" src="[% webroot %]html/global.js?r=[% revision %]"></script>
	<script TYPE="text/javascript">
		// track if sortable effect in use.
		var sortableReordered = false;
		
		var movefromHTML;
		var movetoHTML;
		
		// parse new order for source and target indices
		function reorderlist(order, offset, from) {
			var params;
			
			for (var i=0; i < order.length; i++) {
				var rexp = new RegExp("\\d+$");
				var id = rexp.exec(order[i]);
				
				if (id == from) {
					
					// format level offset for url params
					if (offset) {
						offset = offset + ".";
					} else {
						offset = "";
					}
					
					// pull a background result of the move command
					updateList("action=move&index=" + offset + from + "&to=" + i);
					
					break;
				}
			}
		}
		
		// request and update with new list html
		//TODO target something more appropriate than document.body since we're retrieving the entire html, head and all.
		function updateList(params) {
			new Ajax.Updater( { success: document.body }, webroot + 'xmlbrowser.html', {
				method: 'post',
				postBody: params,
				evalScripts: true,
				asynchronous: true,
				onFailure: function(t) {
					alert('Error -- ' + t.responseText);
				}
			} );
		}
		
		// swallow click event if sortable in progress
		function checkSortable(event) {
			if (sortableReordered) {
				Event.stop(event);
				sortableReordered = false;
			}
		}
		
		// drag and dropfavorites list, scrolling window when needed.
		var activeElem = null;
		function initListSortable(element, offset) {
		
			if (! $(element)) {
				return;
			}
			
			Position.includeScrollOffsets = true;
			
			var activeElem = null;
			//<![CDATA[
			Sortable.create(element, {
				onChange: function(item) {
					var rexp = new RegExp("\\d+$");
					var id = rexp.exec(item.id);
					activeElem = parseInt(id);
					sortableReordered = true;
				},
				onUpdate: function() {
					reorderlist(Sortable.sequence(element), offset, activeElem);
				},
				scroll: window,
				revert: true
			});
			//]]>
		}
	</script>
[% END %][% END %]

[% PROCESS pageheader.html %]

[% IF msg %][% WRAPPER contentcontainer %]
	<b>[% msg %]</b>
[% END %][% END %]

[% IF streaminfo %]
	[% IF streaminfo.item.enclosure || streaminfo.item.url %]
	<div id="songInfoHeader">
		[% WRAPPER playlink %]href="index.html?[% searchquery %]action=play&amp;index=[% streaminfo.index %]&amp;player=[% player | uri %]"[% END %] [% "PLAY_THIS_SONG" | string %]<br />
		[% WRAPPER addlink %]href="index.html?[% searchquery %]action=add&amp;index=[% streaminfo.index %]&amp;player=[% player | uri %]"[% END %] [% "ADD_THIS_SONG_TO_PLAYLIST" | string %]
	</div>
	[% END %]
	
<div class="songInfo">
	
	[% IF streaminfo.item.image %]
	<ul>
		<img src="[% streaminfo.item.image %]" />
	</ul>
	[% END %]
	
	<ul>
		<li><div class="songInfoTitle">[% "TITLE" | string; "COLON" | string %]</div>
			<div class="songInfoText">[% (streaminfo.item.name || streaminfo.item.title) | html %]</div>
		</li>
		
		[% IF streaminfo.item.subtitle %]
		<li><div class="songInfoTitle">[% "XML_SUBTITLE" | string; "COLON" | string %]</div>
			<div class="songInfoText">[% streaminfo.item.subtitle | html %]</div>
		</li>
		[% END %]
		
		[% IF streaminfo.item.pubdate %]
		<li><div class="songInfoTitle">[% "XML_DATE" | string; "COLON" | string %]</div>
			<div class="songInfoText">[% streaminfo.item.pubdate | html %]</div>
		</li>
		[% END %]
		
		[% IF streaminfo.item.url %]
		<li><div class="songInfoTitle">[% "URL" | string; "COLON" | string %]</div>
			<div class="songInfoText"><a href="[% streaminfo.item.url | html %]" target="_blank">[% streaminfo.item.url | html %]</a></div>
		</li>
		[% END %]
		
		[% IF streaminfo.item.description %]
		<li><div class="songInfoTitle">[% "DESCRIPTION" | string; "COLON" | string %]</div>
			<div class="songInfoText">[% streaminfo.item.description | html %]</div>
		</li>
		[% END %]
		
		[% IF streaminfo.item.summary %]
		<li><div class="songInfoTitle">[% "XML_SUMMARY" | string; "COLON" | string %]</div>
			<div class="songInfoText">[% streaminfo.item.summary | html %]</div>
		</li>
		[% END %]
		
		[% IF streaminfo.item.link %]
		<li><div class="songInfoTitle">[% "XML_LINK" | string; "COLON" | string %]</div>
			<div class="songInfoText"><a href="[% streaminfo.item.link | html %]" target="_blank">[% streaminfo.item.link | html %]</a></div>
		</li>
		[% END %]
		
		[% IF streaminfo.item.enclosure %]
		<li><div class="songInfoTitle">[% "XML_ENCLOSURE" | string; "COLON" | string %]</div>
			<div class="songInfoText">
				<a href="[% streaminfo.item.enclosure.url | html %]" target="_blank">[% streaminfo.item.enclosure.url | html %]</a><br />
				[% FILTER format('%.2f'); streaminfo.item.enclosure.length / 1048576; END %] MB
			</div>
		</li>
		[% END %]
		
		[% IF streaminfo.item.duration %]
		<li><div class="songInfoTitle">[% "LENGTH" | string; "COLON" | string %]</div>
			<div class="songInfoText">[% streaminfo.item.duration | html %]</div>
		</li>
		[% END %]
		
		[% IF streaminfo.item.explicit %]
		<li><div class="songInfoTitle">[% "XML_EXPLICIT" | string; "COLON" | string %]</div>
			<div class="songInfoText">[% streaminfo.item.explicit | html %]</div>
		</li>
		[% END %]
		
		[% IF streaminfo.item.bitrate %]
		<li><div class="songInfoTitle">[% "BITRATE" | string; "COLON" | string %]</div>
			<div class="songInfoText">[% streaminfo.item.bitrate | html %] [% "KBPS" | string %]</div>
		</li>
		[% END %]
		
		[% IF streaminfo.item.listeners %]
		<li><div class="songInfoTitle">[% "NUMBER_OF_LISTENERS" | string; "COLON" | string %]</div>
			<div class="songInfoText">[% streaminfo.item.listeners | html %]</div>
		</li>
		[% END %]
		
		[% IF streaminfo.item.current_track %]
		<li><div class="songInfoTitle">[% "NOW_PLAYING" | string; "COLON" | string %]</div>
			<div class="songInfoText">[% streaminfo.item.current_track | html %]</div>
		</li>
		[% END %]
		
		[% IF streaminfo.item.genre %]
		<li><div class="songInfoTitle">[% "GENRE" | string; "COLON" | string %]</div>
			<div class="songInfoText">[% streaminfo.item.genre | html %]</div>
		</li>
		[% END %]
		
		[% IF streaminfo.item.source %]
		<li><div class="songInfoTitle">[% "SOURCE" | string; "COLON" | string %]</div>
			<div class="songInfoText">[% streaminfo.item.source | html %]</div>
		</li>
		[% END %]
	</ul>
</div>
[% END %]

[% IF search %]
	<form id="searchForm" name="searchForm" method="GET">
		<input type="text" id="query" name="query" size="40" value="[% query %]"/>
		<input name="submit" type="submit" class="stdclick" value="[% "SEARCH" | string %]"><p>
		<input type="hidden" value="[% player %]" name="player">
	</form>
[% END %]

[%- odd = 1 %]
[%- IF items -%]
	[% IF hasPagebar %]
		[% "ITEMS" | string %] [% pageinfo.startitem + 1 %] [% "TO" | string %] [% pageinfo.enditem + 1 %] [% "OF" | string %] [% pageinfo.totalitems %]
		[% PROCESS pagebar %]
	[% END %]
	
	[% BLOCK favoritescontrol %]
		[% IF items.favorites == 1 %]
			[% WRAPPER favaddlink noTarget=1 %]
				[%- IF useAJAX -%]href="javascript:void(0);" onClick="updateList('action=favadd&index=[% index _ (start + loop.index) %]')"
				[%- ELSE       -%]href="[% webroot %]plugins/Favorites/index.html?action=favadd&index=[% index _ (start + loop.index) %]"
				[%- END -%]
			[% END %]
		[% ELSIF items.favorites == 2 %]
			[% WRAPPER favdellink noTarget=1 %]
				[%- IF useAJAX -%]href="javascript:void(0);" onClick="updateList('action=favdel&index=[% index _ (start + loop.index) %]')"
				[%- ELSE       -%]href="[% webroot %]plugins/Favorites/index.html?action=favdel&index=[% index _ (start + loop.index) %]"
				[%- END -%]
			[% END %]
		[% END %]
	[% END %]
	
	[%- WRAPPER contentcontainer %]
		[% IF itemsHaveAudio %]
			[%- BLOCK allcontrol -%]
				[% WRAPPER playlink %]href="index.html?[% searchquery %]action=playall&amp;index=[% currentIndex %]&amp;player=[% player | uri %]"[% END %]
				[% WRAPPER addlink %]href="index.html?[% searchquery %]action=addall&amp;index=[% currentIndex %]&amp;player=[% player | uri %]"[% END %]
			[%- END %]
			[%- WRAPPER contentitem leftcontrols = 'allcontrol' %]
				[% "ALL_SONGS" | string %]
			[%- END %]
			[%- odd = (not odd) %]
		[% END %]
		<ol id="draglist" style="padding: 0px; margin: 0px; border: 0px;">
		[%- FOREACH item = items %]
			<li id="dragitem_[% entry.index %]" style="margin: 0px; padding: 0px; border: 0px;" [% IF useAJAX %]onMouseDown="Event.observe('dragitem_[% entry.index %]', 'click', function(event) { checkSortable(event); });"[% END %]>
			[%- BLOCK gencontrol -%]
				[% IF item.type == 'audio' || item.enclosure %]
					[% WRAPPER playlink %]href="index.html?[% searchquery %]action=play&amp;index=[% index _ (start + loop.index) %]&amp;player=[% player | uri %]"[% END %]
					[% WRAPPER addlink %]href="index.html?[% searchquery %]action=add&amp;index=[% index _ (start + loop.index) %]&amp;player=[% player | uri %]"[% END %]
				[% ELSE %]
					[%- WRAPPER descendlink %]href="index.html?[% searchquery %]index=[% index _ (start + loop.index) %]&amp;player=[% player | uri %]"[%- END %]
				[% END %]
			[%- END %]
			[%- WRAPPER contentitem leftcontrols = 'gencontrol' %]
				<a id="dragitemhref_[% entry.index %]" href="index.html?[% searchquery %]index=[% index _ (start + loop.index) %]&amp;player=[% player | uri %]">
					<span id="dragitemtitle_[% entry.index %]">[% item.name || item.title %]</span>
				</a>
			[%- END %]
			</li>
			[%- odd = (not odd) %]
		[%- END %]
		</ol>
	[%- END %]
	[% IF hasPagebar %]
		[% "ITEMS" | string %] [% pageinfo.startitem + 1 %] [% "TO" | string %] [% pageinfo.enditem + 1 %] [% "OF" | string %] [% pageinfo.totalitems %]
		[% PROCESS pagebar %]
	[% END %]
[%- END %]

[% PROCESS pagefooter.html %]

