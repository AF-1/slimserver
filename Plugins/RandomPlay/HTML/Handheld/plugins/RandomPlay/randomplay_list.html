[%# Following two blocks generate links that submit the form if javascript is enabled.  This allows
     users to make setting changes then click on a new mix without having to press the submit button. %]
[%- BLOCK playLink %]
	<a href="[% webroot %]plugins/RandomPlay/randomplay_mix.html?type=[% type %]&addOnly=[% addOnly %]&player=[% player | uri %]"
		onClick='document.genreForm.type.value = "[% type %]";
		document.genreForm.addOnly.value = [% addOnly %]
		document.genreForm.submit();
		for (var i=0; i < parent.frames.length; i++) if (parent.frames[i].name == "status") parent.frames[i].location.reload(true);
		return false;'>
	[%- IF type == "disable" -%]
		[% "PLUGIN_RANDOM_" _ pluginRandomNowPlaying _ "_DISABLE" | string %].
	[%- ELSIF addOnly -%]
		<img src="[% webroot %]html/images/b_add.gif" border=0 width=13 height=13 alt="[% "ADD_TO_PLAYLIST" | string %]" title="[% "ADD_TO_PLAYLIST" | string %]">
	[%- ELSE -%]
		<img src="[% webroot %]html/images/b_play.gif" border=0 width=13 height=13 alt="[% "PLAY" | string %]" title="[% "PLAY" | string %]">
	[%- END -%]
	</a>
[% END -%]

[%- pagetitle = 'PLUGIN_RANDOM' | string; -%]
[% PROCESS pageheader.html %]

[% WRAPPER submenu linktitle=pagetitle %][% END %]
<p></p>

<form action="[% webroot %]plugins/RandomPlay/randomplay_settings.html" name="genreForm">
	<input type="hidden" name="type" value="">
	<input type="hidden" name="addOnly" value="0">
	<input type="hidden" name="player" value="[% player %]">

	[% IF player == '' %]
		<p>[% "NO_PLAYER_FOUND" | string %]</p>
	[% ELSE %]
		<p>[% "PLUGIN_RANDOM_CHOOSE_BELOW" | string %]</p>

		<table cellspacing="0" border="0" cellpadding="4" width="100%">
			[% odd = 0 %]
			[% FOREACH type IN ['track','artist','album','year'] %]
			<tr bgcolor="[% odd ? oddC : evenC %]">
				<td>[% 'PLUGIN_RANDOM_' _ type _ '_WEB' | upper | string %]</td>
				<td>[% PROCESS playLink type="$type" addOnly="0" %]</td>
				<td>[% PROCESS playLink type="$type" addOnly="1" %]</td>
			</tr>
			[% odd = (not odd) %]
			[% END %]
		</table>
		[% IF pluginRandomNowPlaying != '' %]
			<p>
				<strong>[% "NOW_PLAYING" | string %][% "COLON" | string %]</strong>
				[% "PLUGIN_RANDOM_" _ pluginRandomNowPlaying | upper | string %]
			</p>

			<p>
				[% "PLUGIN_RANDOM_GENERAL_HELP" | string %]
				[% PROCESS playLink type="disable" addOnly="0" %]			
			</p>

		[% END %]
	[% END %]	

	<hr>

	<p>[% "PLUGIN_RANDOM_GENRE_FILTER_WEB" | string %]</p>

	
	<table cellspacing="0" border="0" cellpadding="4" width="100%">
		<tr>
			<td>
				<table border="0">[% USE table pluginRandomGenreList.keys.sort, cols=2, pad=0 %]
				[%- FOREACH genrerow = table.rows %]
					<tr>
					[%- FOREACH genre = genrerow %]
					[%- genreid = "genre_" _ pluginRandomGenreList.$genre.id %]
						[%- IF not loop.first %]
						<td>[% nbsp = "&nbsp"; nbsp.repeat(10) %]</td>
						[%- END %]
						<td><input type="checkbox" name="[% genreid %]" id="[% genreid %]" value="1" [% pluginRandomGenreList.$genre.enabled ? "checked" : "" %] onclick="changeNumSelected(this)">
						<label for="[% genreid %]">[% genre | html %]</label></td>
					[%- END %]
					</tr>
				[%- END %]
				</table>
				<script type="text/javascript">
				<!--
					var f = document.genreForm;
					var numSelected = 0;
					var numCheckBoxes = 0;
					var selectAllString = '[% "PLUGIN_RANDOM_SELECT_ALL" | string %]';
					var selectNoneString = '[% "PLUGIN_RANDOM_SELECT_NONE" | string %]';
					
					// Work out how many checkboxes are initially selected
					for (var i=0; i < f.elements.length; i++) {
						if (f.elements[i].type == 'checkbox') {
							numCheckBoxes++;
							if (f.elements[i].checked) {
								numSelected++;
							}
						}
					}
					
					// Select none if all are selected, else select all
					function selectAll() {
						var newState = numSelected != numCheckBoxes;
						
						for (var i=0; i < f.elements.length; i++) {
							if (f.elements[i].type == 'checkbox') {
								f.elements[i].checked = newState;
							}
						}
						if (newState) {
							numSelected = numCheckBoxes;
							f.selectAllButton.value = selectNoneString;
						} else {
							numSelected = 0;
							f.selectAllButton.value = selectAllString;
						}
					}
					
					// Increase/decrease num selected every time a checkbox changes
					function changeNumSelected(checkBox) {
						if (checkBox.checked) {
							numSelected++;
						} else {
							numSelected--;
						}
						
						if (numSelected == numCheckBoxes) {
						  f.selectAllButton.value = selectNoneString;
						} else {
							f.selectAllButton.value = selectAllString;
						}
					}
					
					// Write the button using js, so it won't appear if js isn't enabled/available
					document.write('<input type="button" value="'
					               + (numSelected == numCheckBoxes ? selectNoneString : selectAllString) 
												 + '" id="selectAllButton" onclick="selectAll()">');
				// -->
				</script>
			</td>
		</tr>
	</table>
		
	<p>[% "PLUGIN_RANDOM_BEFORE_NUM_TRACKS" | string %]
		<input class="stdedit" type="text" size="2" name="numTracks" value="[% pluginRandomNumTracks %]">
		[% "PLUGIN_RANDOM_AFTER_NUM_TRACKS" | string %]
		<input class="stdedit" type="text" size="2" name="numOldTracks" value="[% pluginRandomNumOldTracks %]">
		[% "PLUGIN_RANDOM_AFTER_NUM_OLD_TRACKS" | string %]
	</p>
	<p><input type="submit" value="[% "SAVE" | string %]"></p>
</form>

<p></p>
[% PROCESS pagefooter.html %]
