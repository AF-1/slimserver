[%- pagetitle = 'PLUGIN_RANDOM' | string; pageicon = 'PLUGIN_RANDOM' -%]
[%- pageHeaderMenu = BLOCK %] / <a href="[% webroot %]plugins/RandomPlay/randomplay_list.html?player=[% player | uri %]">[% "PLUGIN_RANDOM" | string %]</a>[% END -%]
[%- PROCESS pageheader.html %]

[% BLOCK href %]	
href="[% webroot %]plugins/RandomPlay/randomplay_mix.html?type=[% type %]&player=[% player | uri %]&addOnly=[% addOnly %]"
		 onclick='document.genreForm.type.value = "[% type %]";
							document.genreForm.addOnly.value = [% addOnly %]
							document.genreForm.submit();
							return false;'
[% END %]

[%# Following two blocks generate links that submit the form if javascript is enabled.  This allows
     users to make setting changes then click on a new mix without having to press the submit button. %]
[% BLOCK randomLink %]
	[% IF addOnly;link='addlink';ELSE;link='playlink';END %]
	[% IF type == 'disable' %]
		<a [% PROCESS href %] >[% "PLUGIN_RANDOM_" _ pluginRandomNowPlaying _ "_DISABLE" | string %]</a>
	[% ELSE %]
		[% WRAPPER $link noTarget=1 %]
			[% PROCESS href %]
		[% END %]
	[% END %]
[% END %]

<form action="[% webroot %]plugins/RandomPlay/randomplay_settings.html" name="genreForm">
	<input type="hidden" name="type" value="">
	<input type="hidden" name="addOnly" value="0">
	<input type="hidden" name="player" value="[% player %]">

	<table cellspacing="0" border="0" cellpadding="4" width="100%">
		[% IF player == '' %]
			<tr>
				<td>[% "NO_PLAYER_FOUND" | string %]</td>
			</tr>
		[% ELSE %]
		
			
			<tr>
				<td>[% "PLUGIN_RANDOM_CHOOSE_BELOW" | string %]</td>
			</tr>
			[% odd = 1 %]
			[% FOREACH type IN ['track','artist','album','year'] %]
						<tr>
							[% text = 'PLUGIN_RANDOM_' _ type _ '_WEB' | string %]
							[% WRAPPER listitem title = text %][% END %]
							[% PROCESS randomLink type="track" addOnly="0" %]
							[% PROCESS randomLink type="track" addOnly="1" %]
						</tr>
			[% odd = (not odd) %]
			[% END %]
			[% IF pluginRandomNowPlaying != '' %]
				[%# Reload status and playlist to reflect any new mixes %]
				<script type="text/javascript">
					for (var i=0; i < parent.frames.length; i++) {
						if (parent.frames[i].name == "status") {
							parent.frames[i].location.replace(parent.frames[i].location.pathname + "?player=[% player | uri %]&amp;refresh=1");			
						}
					}
				</script>
				<tr>
					<td>&nbsp;</td>
				</tr>
				
				<tr>
					<td>
						<strong>[% "NOW_PLAYING" | string %]:</strong>
						[% "PLUGIN_RANDOM_" _ pluginRandomNowPlaying | upper | string %]
					</td>
				</tr>

				<tr>
					<td>
						<em>
							[% "PLUGIN_RANDOM_GENERAL_HELP" | string %]
							[% PROCESS randomLink type="disable" addOnly="0" %]			
						</em>
					</td>
				</tr>

				<tr>
					<td>&nbsp;</td>
				</tr>
			[% END %]
		[% END %]	

		<tr>
			<td>&nbsp;</td>
		</tr>
						
		<tr>
			<td colspan="4"><hr></td>
		</tr>

		<tr>
			<td>&nbsp;</td>
		</tr>

		<tr>
			<td>[% "PLUGIN_RANDOM_GENRE_FILTER_WEB" | string %]</td>
		</tr>

		<tr>
			<td>
				<table border="0">[% USE table pluginRandomGenreList.keys.sort, cols=2, pad=0 %]
					[%- FOREACH genrerow = table.rows %]
						<tr>
						[%- FOREACH genre = genrerow %]
						[%- genreid = "genre_" _ pluginRandomGenreList.$genre.id %]
							[%- IF not loop.first %]
							<td>[% nbsp = "&nbsp"; nbsp.repeat(10) %]</td>
							[%- END %]
							<td><input type="checkbox" name="[% genreid %]" id="[% genreid %]" value="1" [% pluginRandomGenreList.$genre.enabled ? "checked" : "" %] onclick="changeNumSelected(this)">
							<label for="[% genreid %]">[% genre | html %]</label></td>
						[%- END %]
						</tr>
					[%- END %]
				</table>
				<script type="text/javascript">
				<!--
					var f = document.genreForm;
					var numSelected = 0;
					var numCheckBoxes = 0;
					var selectAllString = '[% "PLUGIN_RANDOM_SELECT_ALL" | string %]';
					var selectNoneString = '[% "PLUGIN_RANDOM_SELECT_NONE" | string %]';
					
					// Work out how many checkboxes are initially selected
					for (var i=0; i < f.elements.length; i++) {
						if (f.elements[i].type == 'checkbox') {
							numCheckBoxes++;
							if (f.elements[i].checked) {
								numSelected++;
							}
						}
					}
					
					// Select none if all are selected, else select all
					function selectAll() {
						var newState = numSelected != numCheckBoxes;
						
						for (var i=0; i < f.elements.length; i++) {
							if (f.elements[i].type == 'checkbox') {
								f.elements[i].checked = newState;
							}
						}
						if (newState) {
							numSelected = numCheckBoxes;
							f.selectAllButton.value = selectNoneString;
						} else {
							numSelected = 0;
							f.selectAllButton.value = selectAllString;
						}
					}
					
					// Increase/decrease num selected every time a checkbox changes
					function changeNumSelected(checkBox) {
						if (checkBox.checked) {
							numSelected++;
						} else {
							numSelected--;
						}
						
						if (numSelected == numCheckBoxes) {
						  f.selectAllButton.value = selectNoneString;
						} else {
							f.selectAllButton.value = selectAllString;
						}
					}
					
					// Write the button using js, so it won't appear if js isn't enabled/available
					document.write('<input type="button" value="'
								   + (numSelected == numCheckBoxes ? selectNoneString : selectAllString) 
												 + '" id="selectAllButton" onclick="selectAll()">');
				// -->
				</script>
			</td>
		</tr>
		
		<tr>
			<td>&nbsp;</td>
		</tr>

		<tr>
			<td>
				[% "PLUGIN_RANDOM_BEFORE_NUM_TRACKS" | string %]
				<input class="stdedit" type="text" size="2" name="numTracks" value="[% pluginRandomNumTracks %]">
				[% "PLUGIN_RANDOM_AFTER_NUM_TRACKS" | string %]
				<input class="stdedit" type="text" size="2" name="numOldTracks" value="[% pluginRandomNumOldTracks %]">
				[% "PLUGIN_RANDOM_AFTER_NUM_OLD_TRACKS" | string %]
			</td>
		</tr>

		<tr>
			<td>&nbsp;</td>
		</tr>

		<tr>
			<td><input type="submit" value="[% "SAVE" | string %]"></td>
		</tr>
	</table>
</form>
[% PROCESS pagefooter.html %]
